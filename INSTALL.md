# Antiope Scorecards Backend


## DNS Setup

Run `make route53-record-commands-nonprod` and `make route53-record-commands-prod` to list AWS CLI Route 53 commands to setup DNS for the API endpoint, Frontend endpoint, and Frontend certificate validation. Run these commands after deploying the CI/CD.



# App config parameters

**CloudSploitScanningFunctionArn**
Should be the ARN of the CloudSploit scanning engine lambda


## Temp API Environment

### Deploying

Deploying a temporary environment requires you to create a `parameters.local` file that looks like the following:

```bash
export STAGE=...
export CERT_ARN=...
export COGNITO_USER_POOL_ARN=...
export SCORECARD_BUCKET=...
export SCORECARD_PREFIX=...
export RESOURCE_PREFIX=...
export ACCOUNT_SCORES_TABLE=...
export ACCOUNTS_TABLE=...
export AUDIT_TABLE=...
export CONFIG_TABLE=...
export EXCLUSIONS_RESOURCES_TABLE=...
export NCR_TABLE=...
export REQUIREMENTS_TABLE=...
export SCANS_TABLE=...
export SCORES_TABLE=...
export USERS_TABLE=...
```

`STAGE` needs to be a unique identifier for the temporary environment you're deploying to
The rest of the environment variables map directly to CloudFormation parameters in the API stack. The values you pass in here are going to identify what resources the API references. If you want your temporary environment referencing dev resources, you can reference the deployed dev stack for the values you will need.

Once that file exists, run `make deploy-temp-api` to deploy the temporary environment. To cleanup the temporary environment, run `make cleanup-temp-api`.

Note that to run integration tests against your deployed temporary environment, you must pass two parameters to the `integration-test` make target, `STAGE` and `API_STAGE`. `STAGE` will identify non-api resources to reference when running the integration tests, and `API_STAGE` will identify which API to run against. An example would be `make integration-test STAGE=dev API_STAGE=mystage`
